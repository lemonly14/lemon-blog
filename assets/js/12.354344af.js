(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{206:function(s,t,a){"use strict";a.r(t);var n=a(2),r=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"常见的前端传参方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的前端传参方式","aria-hidden":"true"}},[s._v("#")]),s._v(" 常见的前端传参方式")]),s._v(" "),a("p",[s._v("这一节我们聊一下"),a("strong",[s._v("Koa")]),s._v("中的相关参数，我们前端需要经常向服务端传递参数的。")]),s._v(" "),a("p",[s._v("大概有四种我们最常见的传参方式：")]),s._v(" "),a("ul",[a("li",[s._v("url 路径里面传参")]),s._v(" "),a("li",[s._v("在 url 的？后面进行传参")]),s._v(" "),a("li",[s._v("在 http 中的 header 中传参")]),s._v(" "),a("li",[s._v("在 http 中 body 进行传参")])]),s._v(" "),a("h2",{attrs:{id:"postman-发送请求（携带参数）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postman-发送请求（携带参数）","aria-hidden":"true"}},[s._v("#")]),s._v(" postman 发送请求（携带参数）")]),s._v(" "),a("p",[s._v("我们暂时把"),a("code",[s._v("classic.js")]),s._v(" 中的"),a("em",[s._v("get")]),s._v("改为"),a("em",[s._v("post")]),s._v(" , 因为只有在"),a("em",[s._v("post")]),s._v("才能在"),a("strong",[s._v("http")]),s._v("的"),a("strong",[s._v("body")]),s._v("中进行传参。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/v1/:id/classic/latest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'classic'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("现在我们发送"),a("strong",[s._v("post")]),s._v("请求的话，就不能够在浏览器里面输入"),a("strong",[s._v("url")]),s._v("来发送请求了，因为浏览器的"),a("strong",[s._v("url")]),s._v("只能发送"),a("em",[s._v("get")]),s._v("请求不能发送"),a("em",[s._v("post")]),s._v("。这时候都要用到"),a("strong",[s._v("postman")]),s._v("来帮助我们发送请求。")]),s._v(" "),a("p",[s._v("在"),a("strong",[s._v("postman")]),s._v("写请求,不在赘述 看图做就好了")]),s._v(" "),a("p",[a("img",{attrs:{src:"",alt:"postman123"}}),s._v(" "),a("img",{attrs:{src:"",alt:"postman4"}})]),s._v(" "),a("p",[s._v("以上就是我们最常用的四种形式的传递参数方式都覆盖了，现在我们点击"),a("strong",[s._v("postman")]),s._v("的"),a("strong",[s._v("send")]),s._v("就可以请求服务器的接口了。")]),s._v(" "),a("h2",{attrs:{id:"koa-获取参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa-获取参数","aria-hidden":"true"}},[s._v("#")]),s._v(" koa 获取参数")]),s._v(" "),a("p",[a("strong",[s._v("关键服务器如何获取到这四种传递过来的参数。")])]),s._v(" "),a("p",[s._v("在 "),a("strong",[s._v("koa")]),s._v(" 里面可以使用 "),a("code",[s._v("ctx.params")]),s._v(" 来取到 "),a("em",[s._v("id")]),s._v("\n使用 "),a("code",[s._v("ctx.request.query")]),s._v(" 来取到？问号后面的查询参数了\n使用 "),a("code",[s._v("ctx.request.header")]),s._v(" 来取到 "),a("em",[s._v("header")]),s._v(" 里面的参数，由此可见这三种参数都很好获取。")]),s._v(" "),a("p",[s._v("在"),a("strong",[s._v("koa")]),s._v("里面"),a("em",[s._v("body")]),s._v("里面的参数不是很好获取，我们需要通过一个库。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"koa-bodyparser"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^4.2.1"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("通过使用这个库是可以获取到的,它实际上是一个中间件。因为它是一个中间件所以我们在"),a("code",[s._v("app.js")]),s._v("里面注册一下。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" parser "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'koa-bodyparser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这样我们就可以在"),a("strong",[s._v("koa")]),s._v("中使用"),a("strong",[s._v("bodyparser")]),s._v("了，使用也非常的简单。使用"),a("strong",[s._v("ctx.request.body")]),s._v("获取到"),a("em",[s._v("body")]),s._v("里面的参数。")]),s._v(" "),a("p",[a("code",[s._v("classic.js")]),s._v("整体代码：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Router "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'koa-router'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" router "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/v1/:id/classic/latest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("params\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("header\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" body "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'classic'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"查看效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看效果","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看效果")]),s._v(" "),a("p",[s._v("现在我们看看能不能拿到这四种参数。\n我们打一个断点，运行程序。并且用"),a("strong",[s._v("postman")]),s._v("发送"),a("strong",[s._v("http")]),s._v("请求， 看一下效果")]),s._v(" "),a("p",[a("img",{attrs:{src:"",alt:"postman_sccess"}}),s._v("\n在左侧栏可以看到 我们拿到了我们想要的四个参数，我们可以注意到拿到的数据都是 "),a("strong",[s._v("js")]),s._v(" 对象。")]),s._v(" "),a("h2",{attrs:{id:"参数校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数校验","aria-hidden":"true"}},[s._v("#")]),s._v(" 参数校验")]),s._v(" "),a("p",[s._v("接下来才是我们要讲的重点，我们需要"),a("strong",[s._v("校验参数")]),s._v("\n如果我们这些参数不能够很好的校验的话，我们写接口的时候将会非常的麻烦。 我们举个例子，比如我们的 id 号需要传一个正整数，可是用户没有传正整数传了一个字符串"),a("em",[s._v("abc")]),s._v("，那么我们是不是应该校验这种不合法的参数，并且返回给客户端。告诉用户这个参数传的不对。 第二个场景，有的参数是必须要传的，不能是空值。这时候也需要校验出来。 还可以举一个更偏向业务的例子，比如在用户注册的时候，他所填写的数据要符合 "),a("em",[s._v("e-mail")]),s._v("规范的，但是他传过来的是一个任意的字符串。这是必须校验并提示用户提交一个有效的数据。")]),s._v(" "),a("p",[s._v("校验是有两个层面的意义：")]),s._v(" "),a("ul",[a("li",[s._v("防止非法的参数")]),s._v(" "),a("li",[s._v("为客户端给出明确的提示，错在什么地方")])]),s._v(" "),a("p",[s._v("这是前后端联调过程中非常重要的问题，很多时候开发效率低，很多时候是因为服务端人员在开发 "),a("strong",[s._v("api")]),s._v(" 的时候提示不够明确。")]),s._v(" "),a("p",[s._v("很蛋疼的是 koa 里面没有很好用的校验层，作者七月手撸了一个"),a("strong",[s._v("LinValidator")])])])},[],!1,null,null,null);t.default=r.exports}}]);